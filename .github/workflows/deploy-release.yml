name: Deploy Release
on:
  release:
    types: [published]

jobs:
  publish:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]
    steps:
    - name: Download Releases
      uses: robinraju/release-downloader@v1.3
      with:
        repository: "voxelum/x-minecraft-launcher"
        tag: ${{ release.tag_name }}
        out-file-path: build
    - name: Update Web Page
      uses: benc-uk/workflow-dispatch@v1
      with:
        workflow: Deploy
        token: ${{ secrets.PAT_GITHUB_TOKEN }}
        ref: 'master'
        repo: 'voxelum/xmcl-page'
    - name: Upload to Azure
      uses: ci010/upload-blob-to-azure@master
      env:
        AZURE_ACCOUNT_KEY: ${{ secrets.AZURE_ACCOUNT_KEY }}
      with:
        account: xmcl
        container: releases
        directory: ./build